##
## Simple DIRAC buildup configuration file for the Wercker-CI service http://devcenter.wercker.com/articles/werckeryml/
##
##
box: wercker/python

build:
  steps:
    - install-packages:
        packages: "git gcc g++ gfortran make cmake libblas-dev liblapack-dev libfreetype6-dev zlib1g-dev doxygen"

    - pip-install:
        requirements_file: ""
        packages_list: "matplotlib sphinx==1.2.3 sphinxcontrib-bibtex sphinx_rtd_theme hieroglyph"

    - script:
        name: show system resources
        code: |
          lscpu
          df -h
          free -m

    - script:
        name: update submodule, run pamadm and setup configuration scripts
        code: |
          python ./setup --fc=gfortran

    - script:
        name: run ctest for configuration/buildup/test/submit
        code: |
          cd build
          ## we have only 30 minutes for the whole buildup !
          make
          ## ldd : show dependencies
          ldd bin/example
          ## true : this script continues even if some of tests fail
          bin/example

## turn off email notifications
notifications:
        email: false

